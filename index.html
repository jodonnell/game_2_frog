<HTML>


<CANVAS id='gamewindow'></CANVAS>

<SCRIPT src='variables.js'></SCRIPT>
<SCRIPT>

function incrementAnimationFrame(){
  FRAME++;
  FRAME %= 2;
  setTimeout(incrementAnimationFrame,500)
}
incrementAnimationFrame()


function drawRectangle(xposition,yposition,color,x,y,w,h){
  ctx.fillStyle = color;
  ctx.fillRect(x+xposition,y+yposition,w,h);
}


function drawPlayer(){
  const img = PLAYER_SPR[FRAME]
  img.forEach(block => {
	drawRectangle(player.x,player.y,...block)
  })
}

function setPlayerMoveing(dx,dy){
  player.moveing = true;
  player.xSpeed = dx;
  player.ySpeed = dy;
}

document.addEventListener('keydown',(e)=>{
	if (e.repeat || player.moveing)return;
	if (e.key == 'ArrowLeft') setPlayerMoveing(-4,0);
	else if(e.key == 'ArrowRight') setPlayerMoveing(4,0);
	else if(e.key == 'ArrowUp') setPlayerMoveing(0,-4);
})

function PlayerIsOnGrid(){
  return ((player.x % GRID == 0) && (player.y % GRID == 0))

}

function checkPlayerBounds(){
  if (player.x > C_WIDTH - GRID/2 ) player.xSpeed *=-1; 
  else if (player.x < -GRID/2) player.xSpeed *=-1;
  else if (player.y <= -GRID) player.y = C_HEIGHT + player.ySpeed;
}

function movePlayer(){
  if (!player.moveing)return;
  player.x += player.xSpeed;
  player.y += player.ySpeed; 
  checkPlayerBounds()
  if (PlayerIsOnGrid()) player.moveing = false;
}



function gameLoop(){
  requestAnimationFrame(gameLoop)

  ctx.fillStyle = GREY;
  ctx.fillRect(0,0,C_WIDTH,C_HEIGHT);
  
  
  movePlayer()
  drawPlayer()

}
gameLoop()

</SCRIPT>
</HTML>